<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>상품 관리 페이지</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
    :root {
      --bg-color: #f4f7fa;
      --card-bg-color: #ffffff;
      --primary-color: #6a82fb;
      --primary-hover-color: #5468d4;
      --secondary-color: #43d9a0;
      --secondary-hover-color: #35ad80;
      --delete-color: #ff7b7b;
      --delete-hover-color: #e66a6a;
      --text-color: #333;
      --text-light-color: #777;
      --border-color: #e9ecef;
      --shadow-color: rgba(106, 130, 251, 0.15);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Nunito', sans-serif; background-color: var(--bg-color); color: var(--text-color); padding: 2rem; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    .header h1 { font-size: 2rem; font-weight: 700; color: var(--primary-color); }
    .header-actions { display: flex; align-items: center; gap: 1rem; }
    .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.8rem 1.5rem; border-radius: 50px; border: none; color: white; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease, transform 0.2s ease; text-decoration: none; }
    .btn:hover { transform: translateY(-2px); }
    .btn-add { background-color: var(--secondary-color); }
    .btn-add:hover { background-color: var(--secondary-hover-color); }
    .btn-delete-all { background-color: var(--delete-color); }
    .btn-delete-all:hover { background-color: var(--delete-hover-color); }
    .product-list { display: flex; flex-direction: column; gap: 1rem; }
    .product-card { background-color: var(--card-bg-color); border-radius: 12px; box-shadow: 0 4px 15px var(--shadow-color); transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; align-items: center; padding: 1rem; gap: 1.5rem; }
    .product-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--shadow-color); }
    .product-image { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; flex-shrink: 0; }
    .product-info { flex-grow: 1; padding: 0; }
    .product-name { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.25rem; }
    .product-price { font-size: 1rem; font-weight: 600; color: var(--primary-color); margin-bottom: 0.5rem; }
    .product-url { font-size: 0.8rem; color: var(--text-light-color); word-break: break-all; margin-bottom: 0; }
    .product-actions { margin-top: 0; margin-left: auto; display: flex; gap: 0.5rem; }
    .action-btn { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; }
    .action-btn:hover { background-color: #f0f0f0; }
    .action-btn svg { width: 20px; height: 20px; }
  </style>
</head>
<body>

<div class="container">
  <header class="header">
    <h1>상품 관리</h1>
    <div class="header-actions">
      <button type="button" id="delete-all-btn" class="btn btn-delete-all" title="모든 상품을 삭제합니다.">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
          <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5zM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06zm3.5.013l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06zm3.5-.014l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06z"/>
        </svg>
        <span>전체 삭제</span>
      </button>
      <a th:href="@{/management/products/new}" class="btn btn-add">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
        </svg>
        <span>새 상품 추가</span>
      </a>
    </div>
  </header>

  <main class="product-list">
    <div class="product-card" th:id="|product-card-${product.id}|" th:each="product : ${products}">
      <img th:src="${product.imageUrl}" alt="Product Image" class="product-image">
      <div class="product-info">
        <h2 class="product-name" th:text="${product.name}"></h2>
        <p class="product-price" th:text="|${#numbers.formatInteger(product.price, 3, 'COMMA')}원|"></p>
        <p class="product-url" th:text="${product.imageUrl}"></p>
      </div>
      <div class="product-actions">
        <a class="action-btn" th:href="@{/management/products/{id}(id=${product.id})}" title="수정하기">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#6a82fb" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>
        </a>
        <button type="button" class="action-btn delete-btn" th:data-product-id="${product.id}" title="삭제하기">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ff7b7b" class="bi bi-trash3-fill" viewBox="0 0 16 16">
            <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5zM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06zm3.5.013l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06zm3.5-.014l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06z"/>
          </svg>
        </button>
      </div>
    </div>
  </main>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const productList = document.querySelector('.product-list');
    const deleteAllButton = document.getElementById('delete-all-btn');

    if (deleteAllButton) {
      deleteAllButton.addEventListener('click', () => {
        if (confirm('모든 상품을 삭제하시겠습니까?')) {
          fetch('/api/products', {
            method: 'DELETE',
          })
                  .then(response => {
                    if (response.ok) {
                      alert('모든 상품이 삭제되었습니다.');
                      productList.innerHTML = '';
                    } else {
                      response.json().then(errorData => {
                        const messages = Object.values(errorData).join('\n');
                        alert('전체 상품 삭제 실패:\n' + messages);
                      });
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    alert('전체 상품 삭제: 서버와 통신 중 오류가 발생했습니다.');
                  });
        }
      });
    }

    productList.addEventListener('click', (event) => {
      const deleteButton = event.target.closest('.delete-btn');
      if (!deleteButton) {
        return;
      }
      const productId = deleteButton.dataset.productId;
      if (confirm('해당 상품을 정말로 삭제하시겠습니까?')) {
        fetch(`/api/products/${productId}`, {
          method: 'DELETE',
        })
                .then(response => {
                  if (response.ok) {
                    const cardToRemove = document.getElementById(`product-card-${productId}`);
                    if (cardToRemove) {
                      cardToRemove.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                      cardToRemove.style.opacity = '0';
                      cardToRemove.style.transform = 'scale(0.95)';
                      setTimeout(() => cardToRemove.remove(), 400);
                    }
                  } else {
                    response.json().then(errorData => {
                      const messages = Object.values(errorData).join('\n');
                      alert('상품 삭제 실패:\n' + messages);
                    })
                  }
                })
                .catch(error => {
                  console.error('Error:', error);
                  alert('상품 삭제: 서버와 통신 중 오류가 발생했습니다.');
                });
      }
    });
  });
</script>

</body>
</html>
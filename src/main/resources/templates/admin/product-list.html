<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>상품 목록</title>
  <link rel="stylesheet" th:href="@{/css/kakao-style.css}" />
</head>
<body>

<h1>상품 목록</h1>

<div class="top-bar">
  <a href="/admin/products/new" class="button">＋ 상품 등록</a>
</div>

<table>
  <thead>
  <tr>
    <th>상품명</th>
    <th>가격</th>
    <th>이미지</th>
    <th>관리</th>
  </tr>
  </thead>
  <tbody>
  <tr th:if="${products.empty}">
    <td colspan="4">등록된 상품이 없습니다.</td>
  </tr>

  <tr th:each="product : ${products}" style="cursor: pointer;" class="clickable-row"
      th:data-id="${product.id}">
    <td th:text="${product.name}">상품명</td>
    <td th:text="${product.price}">가격</td>
    <td><img th:src="${product.imageUrl}" alt="이미지 없음"/></td>
    <td>
      <a th:href="@{/admin/products/{id}/edit(id=${product.id})}" class="button">수정</a>

      <form th:action="@{/admin/products/{id}(id=${product.id})}"
            method="post"
            class="delete-form">
        <input type="hidden" name="_method" value="delete"/>
        <button type="submit">삭제</button>
      </form>
    </td>
  </tr>
  </tbody>
</table>

<div class="pagination">
  <span th:if="${products.hasPrevious()}">
    <a th:href="@{/admin/products(page=${products.number - 1})}">&laquo; 이전</a>
  </span>

  <span>페이지 <b th:text="${products.number + 1}"></b></span>

  <span th:if="${products.hasNext()}">
    <a th:href="@{/admin/products(page=${products.number + 1})}">다음 &raquo;</a>
  </span>
</div>

<script>
  // 테이블 행 클릭 시 상세 페이지로 이동
  document.querySelectorAll(".clickable-row").forEach(row => {
    row.addEventListener("click", function () {
      const id = this.dataset.id;
      window.location.href = `/admin/products/${id}`;
    });
  });

  // 삭제 버튼 클릭 시 이벤트 버블링 방지
  document.querySelectorAll(".delete-form").forEach(form => {
    form.addEventListener("click", function (event) {
      event.stopPropagation(); // 삭제 버튼 누를 때 tr 클릭 막기
    });

    form.addEventListener("submit", function (event) {
      if (!confirm("정말 삭제하시겠습니까?")) {
        event.preventDefault();
      }
    });
  });
</script>

</body>
</html>
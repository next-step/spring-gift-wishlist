<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ํ์๊ฐ์ / ๋ก๊ทธ์ธ</title>
</head>
<body>
<h1>๐ ํ์๊ฐ์ / ๋ก๊ทธ์ธ ํ์คํธ</h1>

<h2>๐ฉ ํ์๊ฐ์</h2>
<label>Email: <input type="email" id="registerEmail"></label><br>
<label>Password: <input type="password" id="registerPassword"></label><br>
<button onclick="register()">ํ์๊ฐ์</button>
<pre id="registerResult"></pre>

<hr>

<h2>๋ก๊ทธ์ธ</h2>
<label>Email: <input type="email" id="loginEmail"></label><br>
<label>Password: <input type="password" id="loginPassword"></label><br>
<button onclick="login()">๋ก๊ทธ์ธ</button>
<pre id="loginResult"></pre>

<script>
    const registerUrl = "http://localhost:8080/api/members/register";
    const loginUrl = "http://localhost:8080/api/members/login";

    function register() {
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;

        fetch(registerUrl, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({email, password})
        })
            .then(res => {
                if (res.ok) return res.text();
                return res.text().then(text => { throw new Error(text); });
            })
            .then(() => {
                document.getElementById("registerResult").textContent = "ํ์๊ฐ์ ์ฑ๊ณต";
            })
            .catch(err => {
                document.getElementById("registerResult").textContent = "์คํจ: " + err.message;
            });
    }

    function login() {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        fetch(loginUrl, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({email, password})
        })
            .then(res => {
                if (res.ok) return res.json();
                return res.text().then(text => { throw new Error(text); });
            })
            .then(data => {
                localStorage.setItem("token", data.token);
                document.getElementById("loginResult").textContent = "๋ก๊ทธ์ธ ์ฑ๊ณต! ํ์ด์ง ์ด๋ ์ค...";
                setTimeout(() => {
                    window.location.href = "/wishlist";
                }, 1000);
            })
            .catch(err => {
                document.getElementById("loginResult").textContent = "์คํจ: " + err.message;
            });
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
</head>
<body>
<h2>로그인</h2>
<form id="loginForm">
    <label for="email">이메일:</label>
    <input type="email" id="email" name="email" required/><br/>

    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required/><br/>

    <button type="submit">로그인</button>
</form>
<button onclick="location.href='/members/membership'">회원가입</button>
<div id="errorMessage" style="color:red; margin-top:10px;"></div>

<div id="myInfo" style="margin-top:20px;"></div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        const response = await fetch('/members/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        if (response.status === 200) {
            const data = await response.json();
            const jwtToken = data.token;
            localStorage.setItem('jwtToken', jwtToken);

            const infoResponse = await fetch('/members/info', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken
                }
            });

            if (infoResponse.status === 200) {
                const infoData = await infoResponse.json();
                document.getElementById('myInfo').innerHTML =
                    `<h3>내 정보</h3>
                     <p><strong>JWT:</strong> ${infoData.token}</p>`;
                document.getElementById('loginForm').style.display = 'none';
            } else {
                document.getElementById('errorMessage').innerText = '내 정보 조회 실패';
            }
        } else {
            const errorText = await response.text();
            document.getElementById('errorMessage').innerText = errorText || '로그인 실패';
        }
    });
</script>
</body>
</html>

# spring-gift-wishlist

<br>

## 목차

0. [0단계 - 기본 코드 준비](#step-0---기본-코드-준비)
1. [1단계 - 유효성 검사 및 예외 처리](#step-1---유효성-검사-및-예외-처리)
2. [2단계 - 회원 로그인](#step-2---회원-로그인)
3. [3단계 - 위시 리스트](#step-3---위시-리스트)

---

<br>

## Step 0 - 기본 코드 준비

---

#### 기능 요구 사항

- 상품 관리 코드 옮기기
- `미션 1 - step 3`의 코드 리뷰 피드백 반영 : Repository 레이어 생성

---

<br>

## Step 1 - 유효성 검사 및 예외 처리

---

#### 기능 요구 사항

- 상품 이름은 공백을 포함하여 최대 15자까지 입력할 수 있음
- `( ), [ ], +, -, &, /, _` 이외의 특수문자는 사용이 불가함
- `카카오`가 포함된 문구는 담당 MD와 협의한 경우에만 사용 가능


#### 구현 상세 설명

- `ProductRequestDto`를 `record`에서 `class`로 변경
- `validation` 패키지의 어노테이션들을 통해 예외 처리 구현
- 유효성 검사 실패 시 발생하는 `MethodArgumentNotValidException`을 처리하기 위해 `GlobalExceptionHandler`에서 처리
- `"카카오"` 포함 문구에 대한 예외 처리 클래스인 `ForbiddenWordException` 추가 및 핸들러에서 처리하도록 구현

---

<br>

## Step 2 - 회원 로그인

---

#### 기능 요구 사항

- 사용자가 회원 가입, 로그인, 추후 회원별 기능을 이용할 수 있도록 구현
- 이메일, 비밀번호를 입력하여 회원 가입을 진행
- 이메일 중복 및 로그인 실패 시 적절한 예외 처리


#### 구현 상세 설명

- `POST /api/members/register` → 회원 가입
- `POST /api/members/login` → 로그인 및 토큰 발급

<br>

- 토큰을 생성하는 방법으로 `JJWT` 라이브러리를 사용
    + `JwtUtil` 클래스를 만들어 토큰 생성 코드를 재사용할 수 있도록 함
    + 추후 다른 메서드를 추가하여 `Filter`를 적용하는데도 도움을 줄 수 있음
- 커스텀 예외 클래스 추가 (`LoginFailedException`, `DuplicateEmailException`)
- `schema.sql`에 member 테이블 추가 코드 작성, 테스트를 위해 `data.sql`에 멤버 데이터 삽입

---

<br>

## Step 3 - 위시 리스트

---

#### 기능 요구 사항

- 로그인 후 받은 토큰을 사용하여 사용자별 위시 리스트 기능을 구현
    + 위시 리스트에 등록된 상품 목록 조회
    + 위시 리스트에 상품을 추가, 삭제가 가능


#### API 명세

| URL                                                   | 메서드    | 기능           | 설명                       |
|-------------------------------------------------------|--------|--------------|--------------------------|
| /api/wishes                                           | POST   | 위시 리스트 상품 추가 | 회원의 위시 리스트에 상품을 추가한다.    |
| /api/wishes/{wishId}                                  | DELETE | 위시 리스트 상품 삭제 | 회원의 위시 리스트에서 상품을 삭제한다.   |
| /api/wishes | GET    | 위시 리스트 상품 조회 | 회원의 위시 리스트에 있는 상품을 조회한다. |
| /api/wishes{wishId} | PATCH | 위시 리스트 상품 수량 수정 | 회원의 위시 리스트에 있는 상품 수량을 수정한다. |

#### 구현 상세 설명

- `wishlist` 도메인 생성
- 기존 JWT 토큰(email, role)에 member_id 추가
  + 인증된 사용자의 `member_id`는 필터에서 `HttpServletRequest`의 attribute로 저장
- 위시 리스트 CRUD 기능 추가
- 커스텀 어노테이션(`@LoginMember`)과 `HandlerMethodArgumentResolver`을 통해 컨트롤러에 `member_id`를 주입하는 방식 사용
- 위시 리스트 상품 수량 수정 API에서 수량을 0으로 변경 시 삭제되도록 구현